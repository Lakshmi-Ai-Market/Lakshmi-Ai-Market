<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lakshmi AI - Advanced Trading Dashboard</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        select, input {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            margin-bottom: 25px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .price-info {
            text-align: right;
        }

        .current-price {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
        }

        .price-change {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .price-change.positive {
            color: #10b981;
        }

        .price-change.negative {
            color: #ef4444;
        }

        #chartContainer {
            height: 500px;
            border-radius: 15px;
            overflow: hidden;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .info-card h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #666;
            font-weight: 500;
        }

        .metric-value {
            font-weight: 700;
            color: #333;
        }

        .technical-indicators {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .indicator {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .indicator:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .indicator-name {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .indicator-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
        }

        .indicator-signal {
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .signal-bullish {
            background: #dcfce7;
            color: #166534;
        }

        .signal-bearish {
            background: #fef2f2;
            color: #991b1b;
        }

        .signal-neutral {
            background: #f1f5f9;
            color: #475569;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .loading.show {
            display: block;
        }

        .error {
            background: #fef2f2;
            color: #991b1b;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ef4444;
            display: none;
        }

        .error.show {
            display: block;
        }

        .status {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px 20px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .indicators-grid {
                grid-template-columns: 1fr;
            }
            
            #chartContainer {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Lakshmi AI Trading Dashboard</h1>
            <p>Advanced Real-Time Market Analysis & Technical Indicators</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="symbolSelect">Market Symbol</label>
                <select id="symbolSelect">
                    <option value="^NSEI">NIFTY 50 (^NSEI)</option>
                    <option value="^BSESN">SENSEX (^BSESN)</option>
                    <option value="NIFTYBEES.NS">NIFTY BeES</option>
                    <option value="INFY.NS">Infosys</option>
                    <option value="TCS.NS">TCS</option>
                    <option value="RELIANCE.NS">Reliance</option>
                </select>
            </div>

            <div class="control-group">
                <label for="periodSelect">Time Period</label>
                <select id="periodSelect">
                    <option value="7">1 Week</option>
                    <option value="30">1 Month</option>
                    <option value="60" selected>2 Months</option>
                    <option value="90">3 Months</option>
                    <option value="180">6 Months</option>
                </select>
            </div>

            <div class="control-group">
                <label for="intervalSelect">Interval</label>
                <select id="intervalSelect">
                    <option value="1d" selected>Daily</option>
                    <option value="1h">Hourly</option>
                    <option value="5m">5 Minutes</option>
                </select>
            </div>

            <button class="btn" onclick="fetchMarketData()">📊 Analyze Market</button>
            <button class="btn" onclick="autoRefresh()">🔄 Auto Refresh</button>
        </div>

        <div class="loading" id="loading">
            <div>📈 Analyzing market data...</div>
        </div>

        <div class="error" id="error"></div>

        <div class="dashboard">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title" id="chartTitle">NIFTY 50 Chart</div>
                    <div class="price-info">
                        <div class="current-price" id="currentPrice">₹0.00</div>
                        <div class="price-change" id="priceChange">+0.00 (0.00%)</div>
                    </div>
                </div>
                <div id="chartContainer"></div>
            </div>

            <div class="sidebar">
                <div class="info-card">
                    <h3>📊 Market Overview</h3>
                    <div class="metric">
                        <span class="metric-label">Volume</span>
                        <span class="metric-value" id="volume">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg Volume</span>
                        <span class="metric-value" id="avgVolume">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">52W High</span>
                        <span class="metric-value" id="high52w">₹0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">52W Low</span>
                        <span class="metric-value" id="low52w">₹0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Data Points</span>
                        <span class="metric-value" id="dataPoints">0</span>
                    </div>
                </div>

                <div class="info-card">
                    <h3>🎯 Quick Actions</h3>
                    <button class="btn" style="width: 100%; margin-bottom: 10px;" onclick="fetchGlobalData()">🌍 Global Markets</button>
                    <button class="btn" style="width: 100%; margin-bottom: 10px;" onclick="fetchOptionsData()">📈 Options Data</button>
                    <button class="btn" style="width: 100%;" onclick="exportData()">💾 Export Data</button>
                </div>
            </div>
        </div>

        <div class="technical-indicators">
            <h3 style="margin-bottom: 25px; font-size: 1.5rem; color: #333;">🔬 Technical Analysis</h3>
            <div class="indicators-grid">
                <div class="indicator">
                    <div class="indicator-name">SMA 20</div>
                    <div class="indicator-value" id="sma20">₹0</div>
                    <div class="indicator-signal" id="sma20Signal">Neutral</div>
                </div>
                <div class="indicator">
                    <div class="indicator-name">SMA 50</div>
                    <div class="indicator-value" id="sma50">₹0</div>
                    <div class="indicator-signal" id="sma50Signal">Neutral</div>
                </div>
                <div class="indicator">
                    <div class="indicator-name">RSI (14)</div>
                    <div class="indicator-value" id="rsi">50</div>
                    <div class="indicator-signal" id="rsiSignal">Neutral</div>
                </div>
                <div class="indicator">
                    <div class="indicator-name">MACD</div>
                    <div class="indicator-value" id="macd">0.00</div>
                    <div class="indicator-signal" id="macdSignal">Neutral</div>
                </div>
            </div>
        </div>

        <div class="status" id="lastUpdate">
            Ready to analyze market data
        </div>
    </div>

    <script>
        let chart;
        let marketData = {};
        let technicalIndicators = {};
        let currentSymbol = '^NSEI';
        let currentPeriod = 60;
        let currentInterval = '1d';
        let autoRefreshInterval;

        // Initialize chart
        function initChart() {
            const chartContainer = document.getElementById('chartContainer');
            if (chart) {
                chart.remove();
            }
            
            chart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: 500,
                layout: {
                    background: { type: 'solid', color: '#ffffff' },
                    textColor: '#333',
                },
                grid: {
                    vertLines: { color: '#f0f0f0' },
                    horzLines: { color: '#f0f0f0' },
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal,
                },
                rightPriceScale: {
                    borderColor: '#e1e5e9',
                },
                timeScale: {
                    borderColor: '#e1e5e9',
                    timeVisible: true,
                    secondsVisible: false,
                },
            });

            // Handle resize
            window.addEventListener('resize', () => {
                if (chart && chartContainer) {
                    chart.applyOptions({ width: chartContainer.clientWidth });
                }
            });
        }

        // Show loading state
        function showLoading(show) {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            
            if (show) {
                loading.classList.add('show');
                error.classList.remove('show');
            } else {
                loading.classList.remove('show');
            }
        }

        // Show error message
        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.classList.add('show');
            
            setTimeout(() => {
                error.classList.remove('show');
            }, 5000);
        }

        // Format number with commas
        function formatNumber(num) {
            if (!num && num !== 0) return '0';
            return new Intl.NumberFormat('en-IN').format(num);
        }

        // Format currency
        function formatCurrency(num) {
            if (!num && num !== 0) return '₹0.00';
            return '₹' + new Intl.NumberFormat('en-IN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }

        // Fetch market data
        async function fetchMarketData() {
            try {
                showLoading(true);
                
                // Get current selections
                currentSymbol = document.getElementById('symbolSelect').value;
                currentPeriod = parseInt(document.getElementById('periodSelect').value);
                currentInterval = document.getElementById('intervalSelect').value;
                
                console.log('🚀 Fetching data:', { currentSymbol, currentPeriod, currentInterval });
                
                const response = await fetch('https://lakshmi-ai-backend.onrender.com/api/market-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        symbol: currentSymbol,
                        period: currentPeriod,
                        interval: currentInterval
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('✅ Backend Response:', result);
                
                if (result && result.success && result.data) {
                    // BULLETPROOF data validation
                    marketData = {
                        symbol: result.data.symbol || '^NSEI',
                        chart: Array.isArray(result.data.chart) ? result.data.chart : [],
                        current_price: parseFloat(result.data.current_price) || 0,
                        price_change: parseFloat(result.data.price_change) || 0,
                        price_change_pct: parseFloat(result.data.price_change_pct) || 0,
                        volume: parseInt(result.data.volume) || 0,
                        avg_volume: parseInt(result.data.avg_volume) || 0,
                        high_52w: parseFloat(result.data.high_52w) || 0,
                        low_52w: parseFloat(result.data.low_52w) || 0,
                        data_points: parseInt(result.data.data_points) || 0,
                        data_source: result.data.data_source || 'unknown',
                        last_updated: result.data.last_updated || new Date().toISOString(),
                        currency: result.data.currency || 'INR'
                    };
                    
                    technicalIndicators = {
                        sma_20: parseFloat(result.technical_indicators?.sma_20) || 0,
                        sma_50: parseFloat(result.technical_indicators?.sma_50) || 0,
                        rsi: parseFloat(result.technical_indicators?.rsi) || 50,
                        macd: {
                            macd: parseFloat(result.technical_indicators?.macd?.macd) || 0,
                            signal: parseFloat(result.technical_indicators?.macd?.signal) || 0,
                            histogram: parseFloat(result.technical_indicators?.macd?.histogram) || 0
                        }
                    };
                    
                    console.log('✅ Processed Data:', { marketData, technicalIndicators });
                    
                    updateUI();
                    updateChart();
                    updateTechnicalIndicators();
                    
                    document.getElementById('lastUpdate').textContent = 
                        `Last updated: ${new Date(marketData.last_updated).toLocaleTimeString()} | Source: ${marketData.data_source} | Points: ${marketData.data_points}`;
                } else {
                    throw new Error('Invalid data structure received');
                }
                
            } catch (error) {
                console.error('❌ Analysis failed:', error);
                showError(`Analysis failed: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        // Update UI elements
        function updateUI() {
            try {
                // Chart title
                document.getElementById('chartTitle').textContent = `${marketData.symbol} Chart`;
                
                // Price info
                document.getElementById('currentPrice').textContent = formatCurrency(marketData.current_price);
                
                const priceChangeEl = document.getElementById('priceChange');
                const changeText = `${marketData.price_change >= 0 ? '+' : ''}${marketData.price_change.toFixed(2)} (${marketData.price_change_pct.toFixed(2)}%)`;
                priceChangeEl.textContent = changeText;
                priceChangeEl.className = `price-change ${marketData.price_change >= 0 ? 'positive' : 'negative'}`;
                
                // Market overview
                document.getElementById('volume').textContent = formatNumber(marketData.volume);
                document.getElementById('avgVolume').textContent = formatNumber(marketData.avg_volume);
                document.getElementById('high52w').textContent = formatCurrency(marketData.high_52w);
                document.getElementById('low52w').textContent = formatCurrency(marketData.low_52w);
                document.getElementById('dataPoints').textContent = formatNumber(marketData.data_points);
                
            } catch (error) {
                console.error('❌ UI update failed:', error);
            }
        }

        // Update chart
        function updateChart() {
            try {
                if (!chart || !marketData.chart || !Array.isArray(marketData.chart) || marketData.chart.length === 0) {
                    console.warn('⚠️ No chart data available');
                    return;
                }

                // Clear existing series
                chart.remove();
                initChart();

                // Create candlestick series
                const candlestickSeries = chart.addCandlestickSeries({
                    upColor: '#10b981',
                    downColor: '#ef4444',
                    borderDownColor: '#ef4444',
                    borderUpColor: '#10b981',
                    wickDownColor: '#ef4444',
                    wickUpColor: '#10b981',
                });

                // Prepare chart data
                const chartData = marketData.chart.map(item => ({
                    time: Math.floor(item.time / 1000), // Convert to seconds
                    open: parseFloat(item.open) || 0,
                    high: parseFloat(item.high) || 0,
                    low: parseFloat(item.low) || 0,
                    close: parseFloat(item.close) || 0,
                })).filter(item => item.open > 0 && item.high > 0 && item.low > 0 && item.close > 0);

                console.log('📊 Chart data prepared:', chartData.length, 'points');

                if (chartData.length > 0) {
                    candlestickSeries.setData(chartData);
                    
                    // Add SMA lines if available
                    if (technicalIndicators.sma_20 > 0) {
                        const sma20Series = chart.addLineSeries({
                            color: '#3b82f6',
                            lineWidth: 2,
                            title: 'SMA 20'
                        });
                        
                        const sma20Data = chartData.map(item => ({
                            time: item.time,
                            value: technicalIndicators.sma_20
                        }));
                        sma20Series.setData(sma20Data);
                    }
                    
                    if (technicalIndicators.sma_50 > 0) {
                        const sma50Series = chart.addLineSeries({
                            color: '#f59e0b',
                            lineWidth: 2,
                            title: 'SMA 50'
                        });
                        
                        const sma50Data = chartData.map(item => ({
                            time: item.time,
                            value: technicalIndicators.sma_50
                        }));
                        sma50Series.setData(sma50Data);
                    }
                    
                    // Fit content
                    chart.timeScale().fitContent();
                }

            } catch (error) {
                console.error('❌ Chart update failed:', error);
            }
        }

        // Update technical indicators
        function updateTechnicalIndicators() {
            try {
                // SMA 20
                document.getElementById('sma20').textContent = formatCurrency(technicalIndicators.sma_20);
                const sma20Signal = marketData.current_price > technicalIndicators.sma_20 ? 'Bullish' : 'Bearish';
                const sma20El = document.getElementById('sma20Signal');
                sma20El.textContent = sma20Signal;
                sma20El.className = `indicator-signal signal-${sma20Signal.toLowerCase()}`;
                
                // SMA 50
                document.getElementById('sma50').textContent = formatCurrency(technicalIndicators.sma_50);
                const sma50Signal = marketData.current_price > technicalIndicators.sma_50 ? 'Bullish' : 'Bearish';
                const sma50El = document.getElementById('sma50Signal');
                sma50El.textContent = sma50Signal;
                sma50El.className = `indicator-signal signal-${sma50Signal.toLowerCase()}`;
                
                // RSI
                document.getElementById('rsi').textContent = technicalIndicators.rsi.toFixed(2);
                let rsiSignal = 'Neutral';
                if (technicalIndicators.rsi > 70) rsiSignal = 'Overbought';
                else if (technicalIndicators.rsi < 30) rsiSignal = 'Oversold';
                else if (technicalIndicators.rsi > 50) rsiSignal = 'Bullish';
                else rsiSignal = 'Bearish';
                
                const rsiEl = document.getElementById('rsiSignal');
                rsiEl.textContent = rsiSignal;
                rsiEl.className = `indicator-signal signal-${rsiSignal === 'Neutral' ? 'neutral' : rsiSignal === 'Bullish' || rsiSignal === 'Oversold' ? 'bullish' : 'bearish'}`;
                
                // MACD
                document.getElementById('macd').textContent = technicalIndicators.macd.macd.toFixed(2);
                const macdSignal = technicalIndicators.macd.macd > technicalIndicators.macd.signal ? 'Bullish' : 'Bearish';
                const macdEl = document.getElementById('macdSignal');
                macdEl.textContent = macdSignal;
                macdEl.className = `indicator-signal signal-${macdSignal.toLowerCase()}`;
                
            } catch (error) {
                console.error('❌ Technical indicators update failed:', error);
            }
        }

        // Fetch global data
        async function fetchGlobalData() {
            try {
                const response = await fetch('https://lakshmi-ai-backend.onrender.com/global-data');
                const result = await response.json();
                
                if (result.success) {
                    alert(`Global Markets:\n\nNIFTY: ₹${result.data.nifty.value} (${result.data.nifty.changePercent}%)\nSENSEX: ₹${result.data.sensex.value} (${result.data.sensex.changePercent}%)\nDOW: $${result.data.dow.value} (${result.data.dow.changePercent}%)\nNASDAQ: $${result.data.nasdaq.value} (${result.data.nasdaq.changePercent}%)`);
                }
            } catch (error) {
                showError('Failed to fetch global data');
            }
        }

        // Fetch options data
        async function fetchOptionsData() {
            try {
                const response = await fetch('https://lakshmi-ai-backend.onrender.com/options-data');
                const result = await response.json();
                
                if (result.success) {
                    alert(`Options Data:\n\nPCR Ratio: ${result.data.pcr_ratio}\nMax Pain: ₹${result.data.max_pain}\nVIX: ${result.data.vix}\nCall Volume: ${formatNumber(result.data.call_volume)}\nPut Volume: ${formatNumber(result.data.put_volume)}`);
                }
            } catch (error) {
                showError('Failed to fetch options data');
            }
        }

        // Export data
        function exportData() {
            try {
                const dataToExport = {
                    marketData,
                    technicalIndicators,
                    exportTime: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `market-data-${currentSymbol}-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            } catch (error) {
                showError('Failed to export data');
            }
        }

        // Auto refresh
        function autoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                document.querySelector('button[onclick="autoRefresh()"]').textContent = '🔄 Auto Refresh';
            } else {
                autoRefreshInterval = setInterval(fetchMarketData, 30000); // 30 seconds
                document.querySelector('button[onclick="autoRefresh()"]').textContent = '⏹️ Stop Refresh';
                fetchMarketData(); // Immediate fetch
            }
        }

        // Event listeners
        document.getElementById('symbolSelect').addEventListener('change', fetchMarketData);
        document.getElementById('periodSelect').addEventListener('change', fetchMarketData);
        document.getElementById('intervalSelect').addEventListener('change', fetchMarketData);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            fetchMarketData();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97fe4144b7ae3c64',t:'MTc1ODAwMzU5NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
